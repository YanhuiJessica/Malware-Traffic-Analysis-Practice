## Ransom.Troldesh

[TROLDESH.exe (MD5: 5294B2851A648C51DE94FA83B68BB0DF) - Interactive analysis - ANY.RUN](https://app.any.run/tasks/2bb13031-9ef0-40c8-8994-f62ee2abbdbc#)

### DNS Resolutions

Domain | IP
-|-
whatismyipaddress.com|104.16.154.36<br>104.16.155.36
whatsmyip.net|172.67.194.175<br>104.18.34.131<br>104.18.35.131

### Connections

- Tor 通信流量，TCP 流，变化的 IP 地址、端口以及域名<br>
![Tor traffic](img/tor-traffic.jpg)
  - 对于 Tor 的通信流量，都将是 TCP 流，因为它不支持 UDP 协议

### HTTP Requests

- 向`whatismyipaddress.com`请求被感染主机的外部 IP 地址，被`不允许脚本访问`而`403 Forbidden`挡回来了
- 向`whatsmyip.net`请求被感染主机的外部 IP 地址，返回为`185.92.25.187`<br>
![获取被感染主机的 IP 地址](img/what-is-ip-addr.jpg)

## Ransom.Sodinokibi

[368dfd0ce07c2010b0bcfc05b60c653d285b9b201c0da60c3be6f6110a89140d.exe (MD5: 8EA56FD712F728E5ED1A7DCBA86CA9E9) - Interactive analysis - ANY.RUN](https://app.any.run/tasks/fa392158-cf04-43ab-a95e-5083482d57c6/)

本地抓包是为了方便查看浏览网页的产生的通信流量

### DNS Resolutions

大量的 DNS 解析请求（基于 ANY.RUN 运行结果）

```bash
tshark -r Ransom-Sodinokibi.pcap -Y dns.response_to -T fields -e dns.qry.name -e dns.a | tr "\t" "|"
# 再删除人工访问产生的 DNS 解析记录
```

<details>
  <summary>Full Record of DNS Resolutions</summary>

Domain | IP
-|-
richard-felix.co.uk|77.72.0.146
sla-paris.com|109.69.192.190
ccpbroadband.com|173.254.71.141
vesinhnha.com.vn|103.74.118.108
fotoscondron.com|35.209.215.58
deoudedorpskernnoordwijk.nl|95.170.70.118
admos-gleitlager.de|81.169.145.149
theclubms.com|54.247.91.90
mastertechengineering.com|95.217.97.154
jadwalbolanet.info|198.252.100.213
schoolofpassivewealth.com|74.208.236.52
alten-mebel63.ru|Not Found
the-domain-trader.com|213.171.197.190
porno-gringo.com|Not Found
helikoptervluchtnewyork.nl|149.210.170.20
paradicepacks.com|162.252.85.181
denovofoodsgroup.com|Not Found
the-virtualizer.com|5.175.14.53
vox-surveys.com|5.189.182.42
linnankellari.fi|94.237.37.155
polymedia.dk|104.27.138.93,104.27.139.93,172.67.202.201
hokagestore.com|5.45.79.64
shhealthlaw.com|64.150.182.105
pt-arnold.de|82.100.220.37
simoneblum.de|116.203.165.78
pubweb.carnet.hr|193.198.184.106
christinarebuffetcourses.com|35.242.240.46
brevitempore.net,plotlinecreative.com|34.102.136.180
gymnasedumanagement.com|188.165.53.185
icpcnj.org|104.18.32.71,172.67.142.60,104.18.33.71
campusoutreach.org|192.249.121.60
ra-staudte.de|185.21.102.213
toponlinecasinosuk.co.uk|104.31.93.240,104.31.92.240,172.67.160.188
stoeferlehalle.de|130.83.197.236
www.download.windowsupdate.com|2.16.186.56,2.16.186.81
fitnessingbyjessica.com|35.208.117.201
(www.)htchorst.nl|83.98.182.96
deepsouthclothingcompany.com|104.24.106.187,104.24.107.187,172.67.151.14
hypozentrum.com|116.203.66.5
cursoporcelanatoliquido.online|Not Found
socialonemedia.com|172.67.183.207,104.18.47.169,104.18.46.169
ralister.co.uk|88.208.222.39
broseller.com|153.92.9.57
commonground-stories.com|Not Found
unetica.fr|54.38.255.246
bloggyboulga.net|172.67.132.78,104.28.10.69,104.28.11.69
jerling.de|217.160.0.252
smogathon.com|178.32.149.185
ravensnesthomegoods.com|Not Found
(www.)dushka.ua|185.69.155.113
strategicstatements.com|45.79.167.115
bargningharnosand.se|104.27.152.84,104.27.153.84,172.67.205.191
psnacademy.in|104.24.125.195,172.67.174.30,104.24.124.195
degroenetunnel.com|213.108.104.109
parebrise-tla.fr|217.160.0.62
myhostcloud.com|34.98.99.30
new.devon.gov.uk|185.119.173.112
groupe-frayssinet.fr|164.132.235.17
cleliaekiko.online|Not Found
stingraybeach.com|172.67.156.202,104.31.77.248,104.31.76.248
vitavia.lt|212.47.208.136
renergysolution.com|52.2.135.168
(www.)wurmpower.at|62.75.155.70
symphonyenvironmental.com|185.25.240.163
satyayoga.de|212.72.171.140
leather-factory.co.jp|133.18.34.103
consultaractadenacimiento.com|50.31.188.30
321play.com.hk|123.176.96.19
bxdf.info|185.107.227.241
(www.)pv-design.de|93.90.177.166
idemblogs.com|87.98.130.254
beyondmarcomdotcom.wordpress.com<br>globedivers.wordpress.com<br>hairnetty.wordpress.com|192.0.78.12,192.0.78.13
celularity.com|104.198.99.160
bouldercafe-wuppertal.de|5.35.226.158
fiscalsort.com|213.32.37.233
manifestinglab.com|35.221.46.9
mooreslawngarden.com|54.209.112.53
fitnessbazaar.com|Not Found
makeflowers.ru|23.111.202.89
seevilla-dr-sturm.at|85.114.128.65
craigmccabe.fun|Not Found
(www.)corendonhotels.com|136.144.215.188
gw2guilds.org|Not Found
effortlesspromo.com|45.40.155.145
sportsmassoren.com|185.21.40.45
naswrrg.org|104.196.4.83
oldschoolfun.net|194.146.38.243
vanswigchemdesign.com|176.62.165.132
walter-lemm.de|5.35.225.156
thaysa.com|54.69.230.20
clients1.google.com|216.58.205.238
cheminpsy.fr|217.160.0.70
simpkinsedwards.co.uk|185.59.63.16
myteamgenius.com|198.71.233.227
eco-southafrica.com|196.22.132.146
durganews.com|104.27.128.132,172.67.193.129,104.27.129.132
abuelos.com|52.9.202.127
bordercollie-nim.nl|136.144.201.210
vorotauu.ru|92.53.96.116
dezatec.es|51.68.127.96
talentwunder.com|139.59.145.198
muamuadolls.com|23.20.239.12
cactusthebrand.com|93.113.174.221
(www.)drfoyle.com|66.228.32.51
hugoversichert.de|84.19.190.109
coursio.com|146.185.138.244
pinkexcel.com|Not Found
(www.)hkr-reise.de|46.163.78.44
phantastyk.com|209.124.66.12
dubscollective.com|83.170.127.205
lukeshepley.wordpress.com|192.0.78.13,192.0.78.12
thedresserie.com|104.233.202.75,142.4.123.118
wsoil.com.sg|128.199.156.29
slashdb.com|50.19.250.51
better.town|Not Found
sarbatkhalsafoundation.org|198.71.233.227
thailandholic.com|104.28.23.70,172.67.132.100,104.28.22.70
fatfreezingmachines.com|35.213.136.188
kidbucketlist.com.au|162.241.217.210
travelffeine.com|104.28.28.177,172.67.150.49,104.28.29.177
ligiercenter-sachsen.de|87.230.106.214
danielblum.info|162.144.49.40
layrshift.eu|217.160.0.205
frontierweldingllc.com|192.175.104.17
greenpark.ch|149.126.6.52
strandcampingdoonbeg.com|149.202.83.201
jasonbaileystudio.com|93.114.234.173
officehymy.com|157.112.183.48
tstaffing.nl|37.97.240.104
caribdoctor.org|Not Found
greenko.pl|116.202.116.101
krcove-zily.eu|109.74.144.58
x-ray.ca|138.197.148.29
advizewealth.com,echtveilig.nl|23.236.62.147
theduke.de|94.16.115.81
shadebarandgrillorlando.com|192.163.242.193
schoellhammer.com|217.160.0.172
odiclinic.org|198.71.233.64
creative-waves.co.uk|Not Found
groupe-cets.com|185.46.230.5
hotelzentral.at|85.214.103.90
marietteaernoudts.nl|141.138.169.211
revezlimage.com|185.99.48.31
nuzech.com|35.214.16.228
shonacox.com|101.0.119.58
norovirus-ratgeber.de|85.10.214.209
maryloutaylor.com|155.254.18.62
noskierrenteria.com|81.169.181.88
softsproductkey.com,zzyjtsgls.com|142.93.110.250
(www.)naturavetal.hr|78.46.2.139
drinkseed.com|192.185.20.95
yamalevents.com|198.71.233.104
liveottelut.com|95.216.163.228
geoffreymeuli.com|176.62.169.78
mirjamholleman.nl|145.131.29.142
familypark40.com|213.186.33.82
nataschawessels.com|160.153.137.163
baustb.de|85.13.164.99
asiluxury.com|204.11.56.48
adultgamezone.com|213.190.6.70
xn--logopdie-leverkusen-kwb.de|217.160.185.151
streamerzradio1.site|Not Found
gopackapp.com|198.54.117.197,198.54.117.198,198.54.117.199,198.54.117.200
juneauopioidworkgroup.org|74.208.236.91
kosterra.com|35.208.86.60
edrcreditservices.nl|37.97.202.196
spd-ehningen.de|109.237.138.15
polychromelabs.com|104.28.23.95,104.28.22.95,172.67.133.246
toreria.es|217.18.166.138
evologic-technologies.com|46.252.18.72
sportverein-tambach.de|172.67.183.39,104.27.133.164,104.27.132.164
modamilyon.com|82.165.61.200
myzk.site|150.95.54.175
koko-nora.dk|145.239.118.80
forskolorna.org|194.9.94.85,194.9.94.86
safebrowsing.googleapis.com|216.58.207.42

</details>

### Connections

虽然有很多基于 TCP 协议的通信，但 Response 要么是`400 Bad Request`，要么经过 Wireshark 解密后内容仍不可读，有一些则是证书文件，没有太多有用的信息ヽ(o_ _)o

### HTTP Requests

（基于 ANY.RUN 运行结果）从 www.download.windowsupdate.com 下载了压缩文件 authrootstl.cab，解压后是后缀名为 STL 的文件
- 后缀为`.stl`的文件可能是存储 3D 信息的文件，也可能是证书信任列表
- 根据文件名和`binwalk`结果可以判断该文件为证书信任列表
  ```bash
  DECIMAL       HEXADECIMAL     DESCRIPTION
  --------------------------------------------------------------------------------
  145541        0x23885         Certificate in DER format (x509 v3), header length: 4, sequence length: 1556
  147101        0x23E9D         Certificate in DER format (x509 v3), header length: 4, sequence length: 1805
  ```

### Others

- 登录的网站是对应被同一个恶意软件感染的所有机器，并且`Trial decryption`处可以看到其他机器上传文件的解密结果，并可以下载【但是下载失败了，显示`权限不足`emm……】<br>
![试用解密](img/trial-decryption.jpg)
- 只要在合理的长度范围内，`decryptor.cc/`后跟任意字符串都能访问到登录页面，链接的随机性很高，登录后访问到的页面则由密钥来决定<br>
![访问登录页面的链接](img/get-login.jpg)

## 参考资料

- [Sodinokibi - Malware Trends Tracker by ANY.RUN](https://any.run/malware-trends/sodinokibi)
- [STL File Extension - What is an .stl file and how do I open it?](https://fileinfo.com/extension/stl)
- [Decrypting SSL/TLS traffic with Wireshark](https://resources.infosecinstitute.com/decrypting-ssl-tls-traffic-with-wireshark/)