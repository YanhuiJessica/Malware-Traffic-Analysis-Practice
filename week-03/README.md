## 分析工具

在线交互式沙盒 ANYRUN + Wireshark

## W32.HfsAdware.7119

[116673ed59bed28f9ac8ab121bca4fcd66039c46f9d9e8f9ea77c886290fdc16 (MD5: 8B2104E5A7E1F7FB65BAB004E238BD09) - Interactive analysis - ANY.RUN](https://app.any.run/tasks/4d7b851d-0972-49f2-9966-d5666482050f#)

### DNS Resolutions

Domain|IP
-|-
www.demtxr.com|64.111.117.81
ocsp.digicert.com|93.184.220.29
isrg.trustid.ocsp.identrust.com|2.16.107.73<br>2.16.107.80
ocsp.int-x3.letsencrypt.org|2.16.107.114<br>2.16.107.43
www.yolaplay.com|172.67.168.126<br>104.18.32.217<br>104.18.33.217

### HTTP(s) Requests

- 连接 CnC 服务器，下载服务器证书，并替换注册表中已受信根证书键对应的值<br>
![下载证书](img/cnc-cert-download.jpg)
![修改注册表](img/change-regedit-cert.jpg)

- 自动打开 IE 浏览器并访问 http://www.yolaplay.com/thanks/
- 企图通过链接 http://www.yolaplay.com/roblox/download/Roblox.exe 下载可执行程序，下载失败<br>
![资源不存在](img/download-exe-failed.jpg)

- 通过 HTTP 请求检查证书状态，Response 显示状态均为`good`<br>
![证书检验请求](img/check-cert.jpg)

## Generic.StealerA.32DF2DD2

[09002c686e358799a9d732f4483a31a858bb140a3dfd59df54b1d449d2f8122b (MD5: CA56F256DFB3AD7EE41179CF20ED9E3B) - Interactive analysis - ANY.RUN](https://app.any.run/tasks/3860c2f0-5473-40d7-9eef-b900fc4275b6)

### DNS Resolutions

Domain|IP
-|-
t00lz.sourceforge.net|216.105.38.10

### HTTP Requests

- 向`http://t00lz.sourceforge.net/pony/gate.php`发送 POST 请求，附带加密数据，可能是对本地数据的窃取<br>
![POST 请求](img/pony-post.jpg)
  - 不同机器传递的数据不同，[Cuckoo Sandbox - Network](https://cuckoo.cert.ee/analysis/1795650/network/)
- HTTP 请求头一般包含`Referer`字段，用于标识访问来源，而该软件发送 POST 请求的请求头并没有<br>
![No Referer](img/no-referer.jpg)
- ANYRUN 沙盒系统为 32 位 Win7，`User-Agent`则对应 32 位 Win98

## 扩展

- 正常情况下，浏览器发送的 HTTP 请求头不包含`Referer`字段的原因
  - 来源页面采用的协议为本地文件或数据的 URI
  - 当前请求页面采用的是非安全协议，而来源页面采用的是安全协议（HTTPS）

## 参考资料

- [draft-ietf-pkix-ocsp-02 - X.509 Internet Public Key Infrastructure Online Certificate Status Protocol - OCSP](https://tools.ietf.org/html/draft-ietf-pkix-ocsp-02#section-4.6)
- [Referer - HTTP | MDN](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer)