## 分析工具

在线交互式沙盒 ANYRUN + Wireshark

## Smoke Loader

[Subpoena.docx (MD5: 6DC7691612D2AAC4879451144CE5A7B1) - Interactive analysis - ANY.RUN](https://app.any.run/tasks/88b91f0d-827f-44f1-86cc-68e627381644/#)

### DNS Resolutions

secure-net.tech（目前无法访问）

### HTTP requests

通过嵌入式宏下载恶意软件`438279ghh.exe`

User Agent | Browser Type
-|-
Microsoft Office Protocol Discovery|Bot/Crawler
Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; Trident/7.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; ms-office; MSOffice 14)|Application
Microsoft Office Existence Discovery|Bot/Crawler
Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; Trident/7.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E)|Browser

![HTTP requests](img/malware-download.jpg)

### Malware - 438279ghh.exe

[438279ghh.exe (MD5: DC1D6DF1485B25B73EB4577B0E84D23B) - Interactive analysis - ANY.RUN](https://app.any.run/tasks/31401319-fdaf-4c36-9c9e-2f5d45b26501)

- 修改文件
  ```bash
  %TEMP%\9106.tmp
  ```
- 注册表键值修改

  Key|Name|Value
  -|-|-
  HKEY_CURRENT_USER\Software\Microsoft\DirectInput\438279GHH.EXE5E442F5F00098200|Name|438279GHH.EXE
  HKEY_CURRENT_USER\Software\Microsoft\DirectInput\438279GHH.EXE5E442F5F00098200|UsesMapper|` 00 00 00 00 `
  HKEY_CURRENT_USER\Software\Microsoft\DirectInput\MostRecentApplication|Name|438279GHH.EXE
  HKEY_CURRENT_USER\Software\Microsoft\DirectInput\MostRecentApplication|Id|438279GHH.EXE5E442F5F00098200
  HKEY_CURRENT_USER\Software\Microsoft\DirectInput\MostRecentApplication|Version|` 00 08 00 00 `
  HKEY_CURRENT_USER\Software\Microsoft\DirectInput\MostRecentApplication|MostRecentStart|`DA 97 3F 30 5D 5C D6 01`

## 熊猫烧香 - spo0lsv.exe

[GameSetup.exe (MD5: 512301C535C88255C9A252FDF70B7A03) - Interactive analysis - ANY.RUN](https://app.any.run/tasks/7aed44d0-a6c0-4827-875d-110e50abf429#)

### DNS Resolutions

```bash
www.tom.com
www.163.com
www.sohu.com
ocsp.digicert.com
ocsp1.digicert.com
www.yahoo.com
www.google.com
www.ac86.cn
```

### HTTP requests

- http://www.ac86.cn/66/up.txt<br>
  - User-Agent 是 QQ ？！【ET USER_AGENTS Suspicious User-Agent】

  ![文本内容](img/up-txt.jpg)
- 连接了 CnC 服务器<br>
![CnC 服务器 IP 地址](img/connect-to-cnc-server.jpg)
![与 CnC 服务器的通行过程](img/cnc-server-traffic.jpg)
- 对`www.tom.com`、`www.163.com`、`www.sohu.com`、`www.yahoo.com`以及`www.google.com`的 HTTP 请求呈现周期性<br>
![周期性请求](img/periodicity.jpg)
![IP 地址对应 Host](img/periodicity-host.jpg)

## 实验总结

- ANYRUN 作为一款在线交互式沙盒，功能还是非常强大的 (ΦˋωˊΦ)＝З 免费用户也可以享用大部分功能，对于完成一般分析绰绰有余
  - 虽然免费用户的沙盒初始运行时间只有 60 s，但在运行时可以以 60 s 为单位增加时间【但对免费用户的其他限制还是有的，比如只能使用 32 位的 Win 7 系统等，目前看来影响并不大】
  - 一些恶意软件请求的网址可能已经失效，但所有人的分析都是完全公开的，可以直接搜索并查看其他人的历史分析结果，通过运行过程的截图来判断是否符合自己的需要
- 相比于 Cuckoo 的在线分析， ANYRUN 的灵活性更大，并且可以下载 PCAP