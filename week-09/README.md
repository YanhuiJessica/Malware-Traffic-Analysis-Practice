## Emotet

[week-04](../week-04/README.md) 对 Emotet 的分析存在问题，Powershell 执行的命令中包含的网址仅用于下载载荷，而当使用 Fake Net 模式进行分析时，由于无法成功下载载荷，未能通过 Fake Net 模式暴露出 Emotet 其他 CnC 服务器的地址。若要通过 Fake Net 模式来暴露出其他 CnC 服务器的地址，应该直接分析通过 Powershell 下载下来的恶意可执行文件。

[dbf5e53f1d49c11c9da84338b02c9b2f.zip (MD5: E55A65C0E5E98A0BE9B90B255A9F8AEB) - Interactive analysis - ANY.RUN](https://app.any.run/tasks/b4d6dc5d-7528-4edc-9fe3-912f95a4375d/)

### CnC Server

Fake Net: [dbf5e53f1d49c11c9da84338b02c9b2f (MD5: DBF5E53F1D49C11C9DA84338B02C9B2F) - Interactive analysis - ANY.RUN](https://app.any.run/tasks/b4159373-1d7d-4750-b039-3a635ca8d1fd#)

总 CnC 服务器数量为 90 个，即请求的周期。

```bash
tshark -r FakeNet-Emotet.pcap -Y "(http.request or ssl.handshake.type == 1 or tcp.flags eq 0x0002) and !(ssdp)" -T fields -e ip.dst -e tcp.dstport | sort -u | tr "\t" "|"
```

<details>
  <summary>Full Record of CnC Servers' IP Addresses</summary>

IP|Port
-|-
1.54.67.22|80
103.80.51.61|8080
105.209.235.113|8080
107.161.30.122|8080
113.161.148.81|80
113.203.250.121|443
115.78.11.155|80
115.79.195.246|80
118.101.24.148|80
134.209.193.138|443
139.59.12.63|8080
143.95.101.72|8080
157.245.138.101|7080
157.7.164.178|8081
162.144.42.60|8080
162.249.220.190|80
168.0.97.6|80
172.105.78.244|8080
172.96.190.154|8080
173.94.215.84|80
175.29.183.2|80
177.144.130.105|443
177.32.8.85|80
177.94.227.143|80
178.33.167.120|8080
178.87.171.199|80
179.5.118.12|80
179.62.238.49|80
181.113.229.139|443
181.122.154.240|80
181.126.54.234|80
181.137.229.1|80
185.142.236.163|443
185.208.226.142|8080
185.86.148.68|443
186.227.146.102|80
188.0.135.237|80
188.251.213.180|443
189.39.32.161|80
190.136.179.102|80
190.164.75.175|80
190.190.15.20|80
190.212.140.6|80
190.53.144.120|80
190.55.186.229|80
190.96.15.50|80
192.163.221.191|8080
192.210.217.94|8080
192.241.220.183|8080
195.201.56.70|8080
197.221.158.162|80
197.232.36.108|80
198.57.203.63|8080
2.144.244.204|443
201.213.177.139|80
201.235.10.215|80
202.5.47.71|80
203.153.216.178|7080
220.254.198.228|443
24.26.151.3|80
31.146.61.34|80
37.187.100.220|7080
37.205.9.252|7080
37.46.129.215|8080
41.185.29.128|8080
45.182.161.17|80
46.105.131.68|8080
46.32.229.152|8080
5.79.70.250|8080
50.116.78.109|8080
51.38.201.19|7080
54.38.143.245|8080
60.125.114.64|443
66.61.94.36|80
68.183.233.80|8080
71.57.180.213|80
74.208.173.91|8080
75.127.14.170|8080
77.74.78.80|443
81.17.93.134|80
81.214.253.80|443
82.239.200.118|80
86.98.143.163|80
87.106.231.60|8080
88.249.181.198|443
91.75.75.46|80
91.83.93.103|443
94.102.209.63|7080
95.216.205.155|8080
97.107.135.148|8080

</details>

### HTTP Requests

按顺序向 CnC 服务器发送 POST 请求，内容经过加密处理，成功获得任一 CnC 服务器的回复后结束。

### Others

子进程文件名来自系统 DLL 或可执行文件，但各文件哈希值相同<br>
![msidcrl30.dll](img/subprocess-01.jpg)<br>
![notepad.exe](img/subprocess-02.jpg)<br>
![msidcrl30 - e4750b195f84cc8e3ae63180dd22cc7bbd43146403ddfab5e8c99ead7d64efbd](img/msidcrl30-hash.jpg)
![notepad - e4750b195f84cc8e3ae63180dd22cc7bbd43146403ddfab5e8c99ead7d64efbd](img/notepad-hash.jpg)

## Quasar RAT

[29c239614e2d6f4ed3db27d6c3624416a15c10a2e24e1df3f7d9c82bd0742172 (MD5: 73B543E7309982AC5E0F10014956A64E) - Interactive analysis - ANY.RUN](https://app.any.run/tasks/a7c53006-f235-4839-afec-5ef42908a66f#)

### DNS Resolutions

Domain | IP
-|-
ip-api.com|208.95.112.1

### HTTP Requests

- 向 195.2.75.10（2012 端口） 发送 Websocket 握手请求，握手成功并进行数据传输，传输的数据经过编码/加密<br>
![客户端请求及服务器回应](img/websocket.jpg)
- 取得外部 IP 信息（ip-api.com）<br>
![185.107.47.171](img/external-ip.jpg)